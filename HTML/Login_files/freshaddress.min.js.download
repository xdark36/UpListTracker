var faddr_integration={processValidation:function(x){if(x){var formResult={passedValidation:false,responseObj:x.getResponse(),userMessage1:"",userMessage2:"",internalComment:""};if(x.isServiceError()){formResult.passedValidation=true;formResult.internalComment='Service Error: '+formResult.responseObj.ERROR;faddr_debug.logResult("Result: Service error - "+formResult.responseObj.ERROR);return formResult;}faddr_debug.logResult("x.isCachedResponse(): "+x.isCachedResponse());faddr_debug.logResult("x.getCachedAttemptNumber(): "+x.getCachedAttemptNumber());if(x.isValid()){if(x.isSafeToSend()){formResult.passedValidation=true;formResult.internalComment='valid SafeToSend';faddr_debug.logResult("Result: valid SafeToSend");return formResult;}else{if(x.hasSuggest()&&x.getCachedAttemptNumber()<2){formResult.userMessage1="We may have detected a typo.";formResult.userMessage2="- Did you mean to type "+x.getSuggEmail()+"?";formResult.internalComment="valid with suggestion";faddr_debug.logResult("Result: valid with suggestion");return formResult;}else{formResult.passedValidation=true;formResult.internalComment="valid no suggestion";if(x.isOverride()){formResult.internalComment="Customer override - "+formResult.internalComment;faddr_debug.logResult("Result: isOverride: "+x.isOverride());}else{faddr_debug.logResult("Result: isOverride = "+x.isOverride());}return formResult;}}}else if(x.isError()||x.isWarning()){if(x.hasSuggest()){formResult.userMessage1=x.getErrorResponse()+".";formResult.userMessage2="- Did you mean to type "+x.getSuggEmail()+"?";formResult.internalComment="invalid with suggestion";faddr_debug.logResult("Result: invalid with suggestion - "+x.getComment());return formResult;}else{formResult.userMessage1="Please check your typing.";formResult.userMessage2=x.getErrorResponse()+".";formResult.internalComment="invalid no suggestion";faddr_debug.logResult("Result: invalid with no suggestion - "+x.getComment());return formResult;}}else{formResult.passedValidation=true;formResult.internalComment="Error: "+formResult.responseObj.ERROR;faddr_debug.logResult("Result: Error - "+formResult.responseObj.ERROR);return formResult;}}else{formResult.passedValidation=true;formResult.internalComment="Error: "+formResult.responseObj.ERROR;faddr_debug.logResult("Result: Error - "+formResult.responseObj.ERROR);return formResult;}return;},verifyEmail:function(){var email=$(this).val().trim().toUpperCase();var options={role:false,emps:false,rtc_timeout:1200,atc:'c'};var emailbox=$(this).attr('id');if(email!=''){$('#'+emailbox).addClass('ui-autocomplete-loading');if(email!='*NONE'&&!ShopdataUI.ValidEmail(email)){$('#'+emailbox+'_Invalid').show();$('#'+emailbox).addClass('profileInvalid');$('#'+emailbox).removeClass('ui-autocomplete-loading');}else{shopCartUI.checkIfNetworkError(function(){$.ajax({type:"POST",url:ShopdataUI.baseURL+'index.php/main/ShopData_CheckEmailInDB',data:{email:email},dataType:'json',success:function(data){if(data.OCCURRENCE!=0){$('#'+emailbox+'_Invalid').hide();$('#'+emailbox).removeClass('profileInvalid');$('#'+emailbox).removeClass('ui-autocomplete-loading');}else{FreshAddress.validateEmail(email,options).then(function(x){var formResult=faddr_integration.processValidation(x);faddr_debug.logResult(formResult);if(!formResult.passedValidation){$('#'+emailbox+'_Invalid').show();$('#'+emailbox).addClass('profileInvalid');faddr_debug.showRawResponse(null,formResult.responseObj);}else{$('#'+emailbox+'_Invalid').hide();$('#'+emailbox).removeClass('profileInvalid');}$('#'+emailbox).removeClass('ui-autocomplete-loading');});}},error:function(data){$('#'+emailbox).removeClass('ui-autocomplete-loading');}});},'Unable to validate email now network disconnected');}}}}
var faddr_debug={isEnabled:false,showRawResponse:function(src,response){if(faddr_debug.isEnabled){if(src){var rawResults=src+"<br/><br/>"+JSON.stringify(response,null,'\t');}else{var rawResults=JSON.stringify(response,null,'\t');}$("#freshaddress_breakdown").html('<p id="faddr_rawResponse">'+rawResults+'</p>');}},logResult:function(msg){if(faddr_debug.isEnabled){console.log(msg);}}}